<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monochrome</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- 浮动控制按钮 -->
        <div class="floating-controls">
            <!-- 1. 缩放 -->
            <button class="floating-button zoom-btn" @click.stop="toggleZoomPanel" :class="{ active: showZoomPanel }">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M15.5,14L20.5,19L19,20.5L14,15.5V14.71L13.73,14.43C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.43,13.73L14.71,14H15.5M9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14M12,10H10V12H9V10H7V9H9V7H10V9H12V10Z"/>
                </svg>
            </button>
            <!-- 2. 新增 -->
            <button class="floating-button add-btn" @click.stop="toggleAddEventPanel" :class="{ active: showAddEventPanel }" title="新增事件">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
                </svg>
            </button>
            <!-- 3. 筛选 -->
            <button class="floating-button filter-btn" @click.stop="toggleFilterPanel" :class="{ active: showFilterPanel }">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M14,12V19.88C14.04,20.18 13.94,20.5 13.71,20.71C13.32,21.1 12.69,21.1 12.3,20.71L10.29,18.7C10.06,18.47 9.96,18.16 10,17.87V12H9.97L4.21,4.62C3.87,4.19 3.95,3.56 4.38,3.22C4.57,3.08 4.78,3 5,3V3H19V3C19.22,3 19.43,3.08 19.62,3.22C20.05,3.56 20.13,4.19 19.79,4.62L14.03,12H14Z"/>
                </svg>
                <span v-if="Object.keys(selectedTags).length" class="badge">{{ Object.keys(selectedTags).length }}</span>
            </button>
            <!-- 4. 保存 -->
            <button class="floating-button export-btn" @click.stop="exportDataAsYAML" title="导出数据">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M12,19L8,15H10.5V12H13.5V15H16L12,19Z"/>
                </svg>
            </button>
            <!-- 5. 横竖切换 -->
            <button class="floating-button orientation-btn" @click.stop="toggleOrientation" :title="timelineOrientation === 'horizontal' ? '切换到垂直视图' : '切换到水平视图'">
                <!-- 水平视图图标：水平时间轴 + 旋转箭头 -->
                <svg v-if="timelineOrientation === 'horizontal'" viewBox="0 0 24 24" width="24" height="24">
                    <!-- 水平时间轴 -->
                    <line x1="3" y1="12" x2="21" y2="12" stroke="currentColor" stroke-width="2" opacity="0.8"/>
                    <!-- 时间轴节点 -->
                    <circle cx="7" cy="12" r="2" fill="currentColor" opacity="0.6"/>
                    <circle cx="12" cy="12" r="2" fill="currentColor" opacity="0.6"/>
                    <circle cx="17" cy="12" r="2" fill="currentColor" opacity="0.6"/>
                    <!-- 旋转箭头指向垂直 -->
                    <path d="M19 16 L16 19 L19 22" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M5 8 L8 5 L5 2" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <!-- 垂直视图图标：垂直时间轴 + 旋转箭头 -->
                <svg v-else viewBox="0 0 24 24" width="24" height="24">
                    <!-- 垂直时间轴 -->
                    <line x1="12" y1="3" x2="12" y2="21" stroke="currentColor" stroke-width="2" opacity="0.8"/>
                    <!-- 时间轴节点 -->
                    <circle cx="12" cy="7" r="2" fill="currentColor" opacity="0.6"/>
                    <circle cx="12" cy="12" r="2" fill="currentColor" opacity="0.6"/>
                    <circle cx="12" cy="17" r="2" fill="currentColor" opacity="0.6"/>
                    <!-- 旋转箭头指向水平 -->
                    <path d="M16 19 L19 16 L22 19" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M8 5 L5 8 L2 5" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>

        <!-- 缩放控制面板 -->
        <transition name="panel">
            <div v-if="showZoomPanel" class="control-panel zoom-panel" @click.stop>
                <h3>缩放控制</h3>
                <div class="zoom-slider">
                    <button @click="zoomOut" class="icon-btn">−</button>
                    <input type="range" v-model.number="zoomLevel" min="0.5" max="10" step="0.5" class="slider">
                    <button @click="zoomIn" class="icon-btn">+</button>
                </div>
                <div class="zoom-level">{{ zoomLevel.toFixed(1) }}x</div>
                <div class="hint">提示: Ctrl + 滚轮也可以缩放</div>
            </div>
        </transition>

        <!-- 标签筛选面板 -->
        <transition name="panel">
            <div v-if="showFilterPanel" class="control-panel filter-panel" @click.stop>
                <h3>筛选设置</h3>
                
                <!-- 筛选说明 -->
                <div class="filter-hint">
                    <p>点击标签切换状态：</p>
                    <div class="hint-items">
                        <span class="hint-item"><span class="hint-dot hint-none"></span> 未筛选</span>
                        <span class="hint-item"><span class="hint-dot hint-white"></span> 白名单（仅显示）</span>
                        <span class="hint-item"><span class="hint-dot hint-black"></span> 黑名单（不显示）</span>
                    </div>
                    <p class="hint-note">Tips: 黑名单优先级高于白名单</p>
                </div>
                
                <div class="divider"></div>
                
                <!-- 显示/隐藏选项 -->
                <h4>显示选项</h4>
                <div class="visibility-options">
                    <button 
                        class="toggle-btn" 
                        :class="{ active: showTags }"
                        @click="showTags = !showTags"
                    >
                        <svg viewBox="0 0 24 24" width="18" height="18">
                            <path fill="currentColor" d="M5.5,9A1.5,1.5 0 0,0 7,7.5A1.5,1.5 0 0,0 5.5,6A1.5,1.5 0 0,0 4,7.5A1.5,1.5 0 0,0 5.5,9M17.41,11.58C17.77,11.94 18,12.44 18,13C18,13.55 17.78,14.05 17.41,14.41L12.41,19.41C12.05,19.77 11.55,20 11,20C10.45,20 9.95,19.78 9.58,19.41L2.59,12.42C2.22,12.05 2,11.55 2,11V6C2,4.89 2.89,4 4,4H9C9.55,4 10.05,4.22 10.41,4.58L17.41,11.58M13.54,5.71L14.54,4.71L21.41,11.58C21.78,11.94 22,12.45 22,13C22,13.55 21.78,14.05 21.42,14.41L16.04,19.79L15.04,18.79L20.75,13L13.54,5.71Z"/>
                        </svg>
                        <span>标签</span>
                    </button>
                    <button 
                        class="toggle-btn" 
                        :class="{ active: showLocation }"
                        @click="showLocation = !showLocation"
                    >
                        <svg viewBox="0 0 24 24" width="18" height="18">
                            <path fill="currentColor" d="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z"/>
                        </svg>
                        <span>地点</span>
                    </button>
                    <button 
                        class="toggle-btn" 
                        :class="{ active: showNote }"
                        @click="showNote = !showNote"
                    >
                        <svg viewBox="0 0 24 24" width="18" height="18">
                            <path fill="currentColor" d="M14,10V4.5L19.5,10M5,3C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V9L15,3H5Z"/>
                        </svg>
                        <span>备注</span>
                    </button>
                </div>
                
                <div class="divider"></div>
                
                <h4>标签筛选</h4>
                <div class="tag-list">
                    <button 
                        v-for="tag in allTags" 
                        :key="tag"
                        :class="[
                            'tag-chip', 
                            { 
                                'whitelist': selectedTags[tag] === 'whitelist',
                                'blacklist': selectedTags[tag] === 'blacklist'
                            }
                        ]"
                        :style="{ 
                            background: selectedTags[tag] === 'whitelist' ? getTagColor(tag) : 
                                       selectedTags[tag] === 'blacklist' ? '#333' : 'white',
                            borderColor: getTagColor(tag),
                            color: selectedTags[tag] ? 'white' : getTagColor(tag)
                        }"
                        @click="toggleTag(tag)"
                    >
                        <span>{{ tag }}</span>
                        <svg v-if="selectedTags[tag] === 'whitelist'" viewBox="0 0 24 24" width="16" height="16">
                            <path fill="currentColor" d="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"/>
                        </svg>
                        <svg v-else-if="selectedTags[tag] === 'blacklist'" viewBox="0 0 24 24" width="16" height="16">
                            <path fill="currentColor" d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
                        </svg>
                    </button>
                </div>
                <button v-if="Object.keys(selectedTags).length" @click="clearTags" class="clear-all-btn">
                    清除标签筛选
                </button>
            </div>
        </transition>

        <!-- 新增事件面板 -->
        <transition name="panel">
            <div v-if="showAddEventPanel" class="add-event-modal" @click.stop>
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>新增事件</h3>
                        <button class="close-btn" @click="showAddEventPanel = false">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>日期 <span class="required">*</span></label>
                            <input type="date" v-model="newEvent.date" class="form-input">
                        </div>
                        
                        <div class="form-group">
                            <label>标题 <span class="required">*</span></label>
                            <input type="text" v-model="newEvent.title" placeholder="事件标题" class="form-input">
                        </div>
                        
                        <div class="form-group">
                            <label>子标题</label>
                            <input type="text" v-model="newEvent.subtitle" placeholder="事件子标题" class="form-input">
                        </div>
                        
                        <div class="form-group">
                            <label>内容</label>
                            <textarea v-model="newEvent.content" placeholder="事件详细描述" class="form-textarea" rows="3"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>标签</label>
                            <div class="tag-selection-wrapper">
                                <select v-model="newEventTagInput" class="form-select" @change="selectExistingTag(newEventTagInput); newEventTagInput = ''">
                                    <option value="">选择已有标签...</option>
                                    <option v-for="tag in allTags" :key="tag" :value="tag">
                                        {{ tag }}
                                    </option>
                                </select>
                            </div>
                            <div class="tag-input-wrapper">
                                <input 
                                    type="text" 
                                    v-model="newEventTagInput" 
                                    placeholder="或输入新标签" 
                                    class="form-input"
                                    @keyup.enter="addTagToNewEvent"
                                >
                                <input 
                                    type="color" 
                                    v-model="newTagColor" 
                                    class="form-color"
                                    title="新标签颜色"
                                >
                                <button @click="addTagToNewEvent" class="add-tag-btn">添加</button>
                            </div>
                            <div v-if="newEvent.tags.length" class="selected-tags">
                                <span 
                                    v-for="tag in newEvent.tags" 
                                    :key="tag" 
                                    class="tag-item"
                                    :style="{ background: getTagColor(tag) }"
                                >
                                    {{ tag }}
                                    <button @click="removeTagFromNewEvent(tag)" class="remove-tag">×</button>
                                </span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>地点</label>
                            <input type="text" v-model="newEvent.location" placeholder="事件发生地点" class="form-input">
                        </div>
                        
                        <div class="form-group">
                            <label>备注</label>
                            <input type="text" v-model="newEvent.note" placeholder="额外备注信息" class="form-input">
                        </div>
                        
                        <div class="form-group">
                            <label>图片文件名</label>
                            <input type="text" v-model="newEvent.image" placeholder="例如: photo.jpg (需手动放到image目录)" class="form-input">
                            <small class="form-hint">仅填写文件名，图片需手动放到 image/ 目录下</small>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button @click="resetNewEventForm" class="btn-secondary">重置</button>
                        <button @click="saveNewEvent" class="btn-primary">保存事件</button>
                    </div>
                </div>
            </div>
        </transition>

        <!-- 时间轴容器 -->
        <div class="timeline-container" ref="timelineContainer" :class="{ 'vertical': timelineOrientation === 'vertical' }">
            <div class="timeline" 
                :style="{ 
                    width: timelineOrientation === 'horizontal' ? timelineWidth + 'px' : '700px',
                    height: timelineOrientation === 'vertical' ? timelineHeight + 'px' : 'auto'
                }" 
                ref="timeline" 
                :class="{ 'vertical': timelineOrientation === 'vertical' }">
                
                <!-- 水平时间轴 -->
                <svg v-if="timelineOrientation === 'horizontal'" class="timeline-axis" :width="timelineWidth" height="120">
                    <defs>
                        <linearGradient id="lineGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#9fa8a3;stop-opacity:0.4" />
                            <stop offset="30%" style="stop-color:#c7b3be;stop-opacity:0.9" />
                            <stop offset="50%" style="stop-color:#d4a5a5;stop-opacity:1" />
                            <stop offset="70%" style="stop-color:#c7b3be;stop-opacity:0.9" />
                            <stop offset="100%" style="stop-color:#9fa8a3;stop-opacity:0.4" />
                        </linearGradient>
                        <!-- 时间轴发光效果 -->
                        <filter id="lineGlow">
                            <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                            <feMerge>
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                        <!-- 时间轴阴影效果 -->
                        <filter id="lineShadow">
                            <feGaussianBlur in="SourceAlpha" stdDeviation="2"/>
                            <feOffset dx="0" dy="2" result="offsetblur"/>
                            <feComponentTransfer>
                                <feFuncA type="linear" slope="0.4"/>
                            </feComponentTransfer>
                            <feMerge>
                                <feMergeNode/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                    </defs>
                    <!-- 底层发光层 -->
                    <line x1="0" y1="60" :x2="timelineWidth" y2="60" stroke="url(#lineGradient)" stroke-width="12" opacity="0.2" filter="url(#lineGlow)"/>
                    <!-- 底层阴影线 -->
                    <line x1="0" y1="60" :x2="timelineWidth" y2="60" stroke="#c7b3be" stroke-width="9" opacity="0.15"/>
                    <!-- 主时间轴线 -->
                    <line x1="0" y1="60" :x2="timelineWidth" y2="60" stroke="url(#lineGradient)" stroke-width="7" filter="url(#lineShadow)"/>
                    <!-- 高光线 -->
                    <line x1="0" y1="57" :x2="timelineWidth" y2="57" stroke="rgba(255,255,255,0.6)" stroke-width="2" opacity="0.8"/>
                    
                    <!-- 刻度 -->
                    <g v-for="tick in ticks" :key="tick.date">
                        <!-- 普通刻度线 -->
                        <line 
                            v-if="!tick.isTimeJump"
                            :x1="tick.x" 
                            :y1="tick.isEvent ? 45 : 50" 
                            :x2="tick.x" 
                            :y2="tick.isEvent ? 75 : 70" 
                            :stroke="tick.isEvent ? '#c7b3be' : '#e2d5d5'" 
                            :stroke-width="tick.isEvent ? 3 : 2"
                        />
                        <!-- 文字标签 -->
                        <text 
                            :x="tick.x" 
                            :y="tick.isEvent ? 95 : (tick.isTimeJump ? 100 : 90)" 
                            text-anchor="middle" 
                            :font-size="tick.isEvent ? 12 : (tick.isTimeJump ? 11 : 10)"
                            :fill="tick.isEvent ? '#666' : (tick.isTimeJump ? '#d4a5a5' : '#bbb')"
                            :font-weight="tick.isEvent ? '600' : (tick.isTimeJump ? '700' : '400')"
                            font-family="system-ui, -apple-system, sans-serif"
                        >
                            {{ tick.label }}
                        </text>
                    </g>
                </svg>
                
                <!-- 垂直时间轴 -->
                <svg v-if="timelineOrientation === 'vertical'" class="timeline-axis vertical-axis" width="120" :height="timelineHeight">
                    <defs>
                        <linearGradient id="verticalLineGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#9fa8a3;stop-opacity:0.4" />
                            <stop offset="30%" style="stop-color:#c7b3be;stop-opacity:0.9" />
                            <stop offset="50%" style="stop-color:#d4a5a5;stop-opacity:1" />
                            <stop offset="70%" style="stop-color:#c7b3be;stop-opacity:0.9" />
                            <stop offset="100%" style="stop-color:#9fa8a3;stop-opacity:0.4" />
                        </linearGradient>
                    </defs>
                    
                    <!-- 底层发光层 -->
                    <line x1="60" y1="0" x2="60" :y2="timelineHeight" stroke="url(#verticalLineGradient)" stroke-width="12" opacity="0.2" filter="url(#lineGlow)"/>
                    <!-- 底层阴影线 -->
                    <line x1="60" y1="0" x2="60" :y2="timelineHeight" stroke="#c7b3be" stroke-width="9" opacity="0.15"/>
                    <!-- 主时间轴线 -->
                    <line x1="60" y1="0" x2="60" :y2="timelineHeight" stroke="url(#verticalLineGradient)" stroke-width="7" filter="url(#lineShadow)"/>
                    <!-- 高光线 -->
                    <line x1="57" y1="0" x2="57" :y2="timelineHeight" stroke="rgba(255,255,255,0.6)" stroke-width="2" opacity="0.8"/>
                    
                    <!-- 垂直刻度 -->
                    <g v-for="tick in ticks" :key="'vertical-' + tick.date">
                        <!-- 普通刻度线 -->
                        <line 
                            v-if="!tick.isTimeJump"
                            :x1="tick.isEvent ? 45 : 50" 
                            :y1="tick.x" 
                            :x2="tick.isEvent ? 75 : 70" 
                            :y2="tick.x" 
                            :stroke="tick.isEvent ? '#c7b3be' : '#e2d5d5'" 
                            :stroke-width="tick.isEvent ? 3 : 2"
                        />
                        <!-- 文字标签 -->
                        <text 
                            :x="tick.isEvent ? 30 : (tick.isTimeJump ? 25 : 35)" 
                            :y="tick.x + 5" 
                            text-anchor="start" 
                            :font-size="tick.isEvent ? 11 : (tick.isTimeJump ? 10 : 9)"
                            :fill="tick.isEvent ? '#666' : (tick.isTimeJump ? '#d4a5a5' : '#bbb')"
                            :font-weight="tick.isEvent ? '600' : (tick.isTimeJump ? '700' : '400')"
                            font-family="system-ui, -apple-system, sans-serif"
                        >
                            {{ tick.label }}
                        </text>
                    </g>
                </svg>

                <!-- 事件节点 -->
                <div 
                    v-for="(event, index) in filteredEvents" 
                    :key="index"
                    class="event-node"
                    :class="{ 
                        'above-line': getOriginalIndex(event) % 2 === 0, 
                        'below-line': getOriginalIndex(event) % 2 !== 0,
                        'has-image': event.image,
                        'vertical-mode': timelineOrientation === 'vertical'
                    }"
                    :style="timelineOrientation === 'horizontal' ? 
                        { left: getEventPosition(event.date) + 'px' } :
                        { top: getVerticalEventPosition(event.date) + 'px' }
                    "
                >
                    <div class="event-dot"></div>
                    <div class="event-card">
                        <!-- 图片标记 -->
                        <div v-if="event.image" class="image-badge">
                            <svg viewBox="0 0 24 24" width="16" height="16">
                                <path fill="currentColor" d="M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z"/>
                            </svg>
                        </div>
                        <div class="card-header" :style="{ background: getTagGradient(event.tags) }">
                            <div class="event-date">
                                <svg viewBox="0 0 24 24" width="14" height="14">
                                    <path fill="currentColor" d="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3H18V1M17,12H12V17H17V12Z"/>
                                </svg>
                                {{ formatDate(event.date) }}
                            </div>
                        </div>
                        <h3 class="event-title">{{ event.title }}</h3>
                        <div class="event-subtitle">{{ event.subtitle }}</div>
                        <p class="event-content">{{ event.content }}</p>
                        <div class="event-footer">
                            <div v-if="showTags && event.tags && event.tags.length > 0" class="event-tags">
                                <span 
                                    v-for="tag in event.tags" 
                                    :key="tag" 
                                    class="tag"
                                    :style="{ 
                                        '--tag-color': getTagColor(tag),
                                        background: `linear-gradient(135deg, ${getTagColor(tag)}95 0%, ${getTagColor(tag)}80 50%, ${getTagColor(tag)}90 100%)`
                                    }"
                                >{{ tag }}</span>
                            </div>
                            <div class="event-meta">
                                <span v-if="showLocation && event.location" class="meta-item">
                                    <svg viewBox="0 0 24 24" width="14" height="14">
                                        <path fill="currentColor" d="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z"/>
                                    </svg>
                                    {{ event.location }}
                                </span>
                                <span v-if="showNote && event.note" class="meta-item">
                                    <svg viewBox="0 0 24 24" width="14" height="14">
                                        <path fill="currentColor" d="M14,10H19.5L14,4.5V10M5,3H15L21,9V19A2,2 0 0,1 19,21H5C3.89,21 3,20.1 3,19V5C3,3.89 3.89,3 5,3M5,5V19H19V12H12V5H5Z"/>
                                    </svg>
                                    {{ event.note }}
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 图片预览（移到卡片外部） - 上方卡片图片在下，下方卡片图片在上 -->
                    <div v-if="event.image" class="image-preview" :class="{ 'preview-below': getOriginalIndex(event) % 2 === 0, 'preview-above': getOriginalIndex(event) % 2 !== 0 }">
                        <img :src="'./image/' + event.image" :alt="event.title" @error="handleImageError">
                    </div>
                </div>
            </div>
        </div>

        <!-- 缩略图滚动栏 (仅水平模式) -->
        <div v-if="timelineOrientation === 'horizontal'" class="minimap-scrollbar">
            <div class="minimap-track" ref="minimapTrack" @mousedown="clickMinimapTrack">
                <!-- 事件颜色带 -->
                <div 
                    v-for="event in filteredEvents" 
                    :key="event.date"
                    class="minimap-item"
                    :style="getMinimapItemStyle(event)"
                ></div>
                <!-- 可拖动的视口窗口 -->
                <div 
                    class="minimap-viewport" 
                    :style="{
                        left: (minimap.scrollRatio * (100 - minimap.viewportWidth)) + '%',
                        width: minimap.viewportWidth + '%'
                    }"
                    @mousedown="startMinimapDrag"
                ></div>
            </div>
        </div>

        <!-- 页脚信息 -->
        <footer class="app-footer">
            <div class="footer-content">
                <span class="footer-author">{{ appMeta.author }}</span>
                <span class="footer-divider">|</span>
                <span class="footer-year">{{ appMeta.year }}</span>
            </div>
        </footer>
    </div>

    <script src="app.js"></script>
</body>
</html>
