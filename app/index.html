<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monochrome</title>
    <link rel="stylesheet" href="css/main.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- 浮动控制按钮 -->
        <div class="floating-controls">
            <!-- 主题切换 -->
            <button class="floating-button theme-btn" @click.stop="toggleTheme" :title="isDarkMode ? '切换到白天模式' : '切换到夜间模式'">
                <svg v-if="!isDarkMode" viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M17.75,4.09L15.22,6.03L16.13,9.09L13.5,7.28L10.87,9.09L11.78,6.03L9.25,4.09L12.44,4L13.5,1L14.56,4L17.75,4.09M21.25,11L19.61,12.25L20.2,14.23L18.5,13.06L16.8,14.23L17.39,12.25L15.75,11L17.81,10.95L18.5,9L19.19,10.95L21.25,11M18.97,15.95C19.8,15.87 20.69,17.05 20.16,17.8C19.84,18.25 19.5,18.67 19.08,19.07C15.17,23 8.84,23 4.94,19.07C1.03,15.17 1.03,8.83 4.94,4.93C5.34,4.53 5.76,4.17 6.21,3.85C6.96,3.32 8.14,4.21 8.06,5.04C7.79,7.9 8.75,10.87 10.95,13.06C13.14,15.26 16.1,16.22 18.97,15.95M17.33,17.97C14.5,17.81 11.7,16.64 9.53,14.5C7.36,12.31 6.2,9.5 6.04,6.68C3.23,9.82 3.34,14.64 6.35,17.66C9.37,20.67 14.19,20.78 17.33,17.97Z"/>
                </svg>
                <svg v-else viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,2L14.39,5.42C13.65,5.15 12.84,5 12,5C11.16,5 10.35,5.15 9.61,5.42L12,2M3.34,7L7.5,6.65C6.9,7.16 6.36,7.78 5.94,8.5C5.5,9.24 5.25,10 5.11,10.79L3.34,7M3.36,17L5.12,13.23C5.26,14 5.53,14.78 5.95,15.5C6.37,16.24 6.91,16.86 7.5,17.37L3.36,17M20.65,7L18.88,10.79C18.74,10 18.47,9.23 18.05,8.5C17.63,7.78 17.1,7.15 16.5,6.64L20.65,7M20.64,17L16.5,17.36C17.09,16.85 17.62,16.22 18.04,15.5C18.46,14.77 18.73,14 18.87,13.21L20.64,17M12,22L9.59,18.56C10.33,18.83 11.14,19 12,19C12.82,19 13.63,18.83 14.37,18.56L12,22Z"/>
                </svg>
            </button>
            <!-- 缩放 -->
            <button class="floating-button zoom-btn" @click.stop="toggleZoomPanel" :class="{ active: showZoomPanel }">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M15.5,14L20.5,19L19,20.5L14,15.5V14.71L13.73,14.43C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.43,13.73L14.71,14H15.5M9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14M12,10H10V12H9V10H7V9H9V7H10V9H12V10Z"/>
                </svg>
            </button>
            <!-- 新增 -->
            <button class="floating-button add-btn" @click.stop="toggleAddEventPanel" :class="{ active: showAddEventPanel }" title="新增事件">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
                </svg>
            </button>
            <!-- 筛选 -->
            <button class="floating-button filter-btn" @click.stop="toggleFilterPanel" :class="{ active: showFilterPanel }">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M14,12V19.88C14.04,20.18 13.94,20.5 13.71,20.71C13.32,21.1 12.69,21.1 12.3,20.71L10.29,18.7C10.06,18.47 9.96,18.16 10,17.87V12H9.97L4.21,4.62C3.87,4.19 3.95,3.56 4.38,3.22C4.57,3.08 4.78,3 5,3V3H19V3C19.22,3 19.43,3.08 19.62,3.22C20.05,3.56 20.13,4.19 19.79,4.62L14.03,12H14Z"/>
                </svg>
                <span v-if="Object.keys(selectedTags).length" class="badge">{{ Object.keys(selectedTags).length }}</span>
            </button>
            <!-- 分析 -->
            <button class="floating-button analysis-btn" @click.stop="toggleAnalysisPanel" :class="{ active: showAnalysisPanel }" title="数据分析">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M9,17H7V10H9V17M13,17H11V7H13V17M17,17H15V13H17V17M19,19H5V5H19V19M19,3H5C3.89,3 3,3.89 3,5V19C3,20.1 3.89,21 5,21H19C20.1,21 21,20.1 21,19V5C21,3.89 20.1,3 19,3Z"/>
                </svg>
            </button>
            <!-- 保存 -->
            <button class="floating-button export-btn" @click.stop="exportDataAsYAML" title="导出数据">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M12,19L8,15H10.5V12H13.5V15H16L12,19Z"/>
                </svg>
            </button>
        </div>

        <!-- 缩放控制面板 -->
        <transition name="panel">
            <div v-if="showZoomPanel" class="control-panel zoom-panel" @click.stop>
                <h3>缩放控制</h3>
                <div class="zoom-slider">
                    <button @click="zoomOut" class="icon-btn">−</button>
                    <input type="range" v-model.number="zoomLevel" min="0.5" max="10" step="0.5" class="slider">
                    <button @click="zoomIn" class="icon-btn">+</button>
                </div>
                <div class="zoom-level">{{ zoomLevel.toFixed(1) }}x</div>
                <div class="hint">提示: Ctrl + 滚轮也可以缩放</div>
            </div>
        </transition>

        <!-- 标签筛选面板 -->
        <transition name="panel">
            <div v-if="showFilterPanel" class="control-panel filter-panel" @click.stop>
                <h3>筛选设置</h3>
                
                <!-- 筛选说明 -->
                <div class="filter-hint">
                    <p>点击标签切换状态：</p>
                    <div class="hint-items">
                        <span class="hint-item"><span class="hint-dot hint-none"></span> 未筛选</span>
                        <span class="hint-item"><span class="hint-dot hint-white"></span> 白名单（仅显示）</span>
                        <span class="hint-item"><span class="hint-dot hint-black"></span> 黑名单（不显示）</span>
                    </div>
                    <p class="hint-note">Tips: 黑名单优先级高于白名单</p>
                </div>
                
                <div class="divider"></div>
                
                <!-- 显示/隐藏选项 -->
                <h4>显示选项</h4>
                <div class="visibility-options">
                    <button 
                        class="toggle-btn" 
                        :class="{ active: showTags }"
                        @click="showTags = !showTags"
                    >
                        <svg viewBox="0 0 24 24" width="18" height="18">
                            <path fill="currentColor" d="M5.5,9A1.5,1.5 0 0,0 7,7.5A1.5,1.5 0 0,0 5.5,6A1.5,1.5 0 0,0 4,7.5A1.5,1.5 0 0,0 5.5,9M17.41,11.58C17.77,11.94 18,12.44 18,13C18,13.55 17.78,14.05 17.41,14.41L12.41,19.41C12.05,19.77 11.55,20 11,20C10.45,20 9.95,19.78 9.58,19.41L2.59,12.42C2.22,12.05 2,11.55 2,11V6C2,4.89 2.89,4 4,4H9C9.55,4 10.05,4.22 10.41,4.58L17.41,11.58M13.54,5.71L14.54,4.71L21.41,11.58C21.78,11.94 22,12.45 22,13C22,13.55 21.78,14.05 21.42,14.41L16.04,19.79L15.04,18.79L20.75,13L13.54,5.71Z"/>
                        </svg>
                        <span>标签</span>
                    </button>
                    <button 
                        class="toggle-btn" 
                        :class="{ active: showLocation }"
                        @click="showLocation = !showLocation"
                    >
                        <svg viewBox="0 0 24 24" width="18" height="18">
                            <path fill="currentColor" d="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z"/>
                        </svg>
                        <span>地点</span>
                    </button>
                    <button 
                        class="toggle-btn" 
                        :class="{ active: showNote }"
                        @click="showNote = !showNote"
                    >
                        <svg viewBox="0 0 24 24" width="18" height="18">
                            <path fill="currentColor" d="M14,10V4.5L19.5,10M5,3C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V9L15,3H5Z"/>
                        </svg>
                        <span>备注</span>
                    </button>
                </div>
                
                <div class="divider"></div>
                
                <h4>标签筛选</h4>
                <div class="tag-list">
                    <button 
                        v-for="tag in allTags" 
                        :key="tag"
                        :class="[
                            'tag-chip', 
                            { 
                                'whitelist': selectedTags[tag] === 'whitelist',
                                'blacklist': selectedTags[tag] === 'blacklist'
                            }
                        ]"
                        :style="{ 
                            background: selectedTags[tag] === 'whitelist' ? getTagColor(tag, tagColors, isDarkMode) : 
                                       selectedTags[tag] === 'blacklist' ? '#333' : 'white',
                            borderColor: getTagColor(tag, tagColors, isDarkMode),
                            color: selectedTags[tag] ? 'white' : getTagColor(tag, tagColors, isDarkMode)
                        }"
                        @click="toggleTag(tag)"
                    >
                        <span>{{ tag }}</span>
                        <svg v-if="selectedTags[tag] === 'whitelist'" viewBox="0 0 24 24" width="16" height="16">
                            <path fill="currentColor" d="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"/>
                        </svg>
                        <svg v-else-if="selectedTags[tag] === 'blacklist'" viewBox="0 0 24 24" width="16" height="16">
                            <path fill="currentColor" d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
                        </svg>
                    </button>
                </div>
                <button v-if="Object.keys(selectedTags).length" @click="clearTags" class="clear-all-btn">
                    清除标签筛选
                </button>
            </div>
        </transition>

        <!-- 新增事件面板 -->
        <transition name="panel">
            <div v-if="showAddEventPanel" class="add-event-modal" @click.stop>
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>新增事件</h3>
                        <!-- 后端服务标记 -->
                        <span v-if="backendConfig.enabled" class="backend-badge" title="已连接到后端服务">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                <path d="M2 17l10 5 10-5"></path>
                                <path d="M2 12l10 5 10-5"></path>
                            </svg>
                            API
                        </span>
                        <button class="close-btn" @click="showAddEventPanel = false">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>日期 <span class="required">*</span></label>
                            <input type="date" v-model="newEvent.date" class="form-input">
                        </div>
                        
                        <div class="form-group">
                            <label>标题 <span class="required">*</span></label>
                            <input type="text" v-model="newEvent.title" placeholder="事件标题" class="form-input">
                        </div>
                        
                        <div class="form-group">
                            <label>子标题</label>
                            <input type="text" v-model="newEvent.subtitle" placeholder="事件子标题" class="form-input">
                        </div>
                        
                        <div class="form-group">
                            <label>内容</label>
                            <textarea v-model="newEvent.content" placeholder="事件详细描述" class="form-textarea" rows="3"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>标签</label>
                            <div class="tag-selection-wrapper">
                                <select v-model="newEventTagInput" class="form-select" @change="selectExistingTag(newEventTagInput); newEventTagInput = ''">
                                    <option value="">选择已有标签...</option>
                                    <option v-for="tag in allTags" :key="tag" :value="tag">
                                        {{ tag }}
                                    </option>
                                </select>
                            </div>
                            <div class="tag-input-wrapper">
                                <input 
                                    type="text" 
                                    v-model="newEventTagInput" 
                                    placeholder="或输入新标签" 
                                    class="form-input"
                                    @keyup.enter="addTagToNewEvent"
                                >
                                <input 
                                    type="color" 
                                    v-model="newTagColor" 
                                    class="form-color"
                                    title="新标签颜色"
                                >
                                <button @click="addTagToNewEvent" class="add-tag-btn">添加</button>
                            </div>
                            <div v-if="newEvent.tags.length" class="selected-tags">
                                <span 
                                    v-for="tag in newEvent.tags" 
                                    :key="tag" 
                                    class="tag-item"
                                    :style="{ background: getTagColor(tag, tagColors, isDarkMode) }"
                                >
                                    {{ tag }}
                                    <button @click="removeTagFromNewEvent(tag)" class="remove-tag">×</button>
                                </span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>地点</label>
                            <input type="text" v-model="newEvent.location" placeholder="事件发生地点" class="form-input">
                        </div>
                        
                        <div class="form-group">
                            <label>备注</label>
                            <input type="text" v-model="newEvent.note" placeholder="额外备注信息" class="form-input">
                        </div>
                        
                        <div class="form-group">
                            <label>图片文件名</label>
                            <input type="text" v-model="newEvent.image" placeholder="例如: photo.jpg (需手动放到image目录)" class="form-input">
                            <small class="form-hint">仅填写文件名，图片需手动放到 image/ 目录下</small>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <div class="footer-left">
                            <button 
                                class="toggle-btn" 
                                :class="{ active: continuousAdd }"
                                @click="continuousAdd = !continuousAdd"
                                type="button"
                            >
                                <svg viewBox="0 0 24 24" width="18" height="18">
                                    <path fill="currentColor" d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
                                </svg>
                                <span>连续新增</span>
                            </button>
                        </div>
                        <div class="footer-right">
                            <button @click="resetNewEventForm" class="btn-secondary">重置</button>
                            <button @click="saveNewEvent" class="btn-primary">保存事件</button>
                        </div>
                    </div>
                </div>
            </div>
        </transition>

        <!-- 数据分析面板 -->
        <transition name="panel">
            <div v-if="showAnalysisPanel" class="analysis-modal" @click.stop>
                <div class="modal-content analysis-content">
                    <div class="modal-header analysis-header">
                        <button class="close-btn" @click="showAnalysisPanel = false">×</button>
                    </div>

                    <div class="modal-body analysis-body split-view">
                        <!-- 左侧：热力图 -->
                        <div class="analysis-left">
                            <div class="heatmap-container">
                                <div class="heatmap-grid-monthly">
                                    <div class="heatmap-header-row">
                                        <div></div>
                                        <div v-for="month in 12" :key="month" class="month-header-label">
                                            {{ month }}
                                        </div>
                                    </div>
                                    
                                    <div 
                                        v-for="(item, index) in analysisData.heatmapData" 
                                        :key="item.year" 
                                        class="heatmap-year-row"
                                        :class="{ 'year-gap': index < analysisData.heatmapData.length - 1 && item.year % 5 === 0 }"
                                    >
                                        <div class="year-row-label">{{ item.year }}</div>
                                        <div class="year-row-cells">
                                            <div 
                                                v-for="(monthData, idx) in item.months" 
                                                :key="idx"
                                                class="heatmap-cell-monthly"
                                                :class="{ 'has-data': monthData.count > 0 }"
                                                :style="{ background: getHeatmapColor(monthData.count) }"
                                                @mouseenter="onHeatmapCellHover(item.year, idx, monthData)"
                                                @mouseleave="onHeatmapCellLeave"
                                            >
                                                <span v-if="monthData.count > 0" class="cell-count">{{ monthData.count }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 右侧：动态信息面板 -->
                        <div class="analysis-right">
                            <!-- 固定部分：总览 -->
                            <div class="analysis-overview">
                                <div class="info-panel default-view">
                                    <div class="info-group">
                                        <div class="info-label">总事件</div>
                                        <div class="info-value">{{ analysisData.total }}</div>
                                    </div>
                                    <div class="detail-stats">
                                        <div class="mini-stat">
                                            <span class="label">博客</span>
                                            <span class="value">{{ analysisData.blogs }}</span>
                                        </div>
                                        <div class="mini-stat">
                                            <span class="label">标签</span>
                                            <span class="value">{{ analysisData.totalTags }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 动态部分：具体内容 -->
                            <div class="analysis-details">
                                <transition name="fade" mode="out-in">
                                    <div v-if="hoveredCell" :key="`${hoveredCell.year}-${hoveredCell.month}`" class="info-panel detail-view">
                                        <div class="detail-header">
                                            <div class="detail-date">{{ hoveredCell.year }}年{{ hoveredCell.month }}月</div>
                                        </div>
                                        
                                        <div class="detail-stats">
                                            <div class="mini-stat">
                                                <span class="label">事件</span>
                                                <span class="value">{{ hoveredCell.count }}</span>
                                            </div>
                                            <div class="mini-stat">
                                                <span class="label">博客</span>
                                                <span class="value">{{ hoveredCell.blogs }}</span>
                                            </div>
                                        </div>

                                        <div class="detail-tags-list" v-if="Object.keys(hoveredCell.tags).length > 0">
                                            <div class="tags-title">包含标签</div>
                                            <div class="tags-grid">
                                                <div v-for="(count, tag) in hoveredCell.tags" :key="tag" class="mini-tag" :style="{ borderColor: getTagColor(tag, tagColors, isDarkMode), color: getTagColor(tag, tagColors, isDarkMode) }">
                                                    <span class="tag-text">{{ tag }}</span>
                                                    <span class="tag-count-badge" :style="{ background: getTagColor(tag, tagColors, isDarkMode) }">{{ count }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div v-else class="empty-state-hint">
                                        <div class="hint-icon">
                                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                                <line x1="3" y1="9" x2="21" y2="9"></line>
                                                <line x1="9" y1="21" x2="9" y2="9"></line>
                                            </svg>
                                        </div>
                                        <p>将鼠标悬停在热力图方格上<br>以查看详细数据</p>
                                    </div>
                                </transition>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </transition>

        <!-- 时间轴容器 -->
        <div class="timeline-container" ref="timelineContainer">
            <div class="timeline" 
                :style="{ width: timelineWidth + 'px' }" 
                ref="timeline">
                
                <!-- 水平时间轴 -->
                <svg class="timeline-axis" :width="timelineWidth" height="120">
                    <defs>
                        <linearGradient id="lineGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#9fa8a3;stop-opacity:0.4" />
                            <stop offset="30%" style="stop-color:#c7b3be;stop-opacity:0.9" />
                            <stop offset="50%" style="stop-color:#d4a5a5;stop-opacity:1" />
                            <stop offset="70%" style="stop-color:#c7b3be;stop-opacity:0.9" />
                            <stop offset="100%" style="stop-color:#9fa8a3;stop-opacity:0.4" />
                        </linearGradient>
                        <!-- 时间轴发光效果 -->
                        <filter id="lineGlow">
                            <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                            <feMerge>
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                        <!-- 时间轴阴影效果 -->
                        <filter id="lineShadow">
                            <feGaussianBlur in="SourceAlpha" stdDeviation="2"/>
                            <feOffset dx="0" dy="2" result="offsetblur"/>
                            <feComponentTransfer>
                                <feFuncA type="linear" slope="0.4"/>
                            </feComponentTransfer>
                            <feMerge>
                                <feMergeNode/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                    </defs>
                    <!-- 底层发光层 -->
                    <line x1="0" y1="60" :x2="timelineWidth" y2="60" stroke="url(#lineGradient)" stroke-width="12" opacity="0.2" filter="url(#lineGlow)"/>
                    <!-- 底层阴影线 -->
                    <line x1="0" y1="60" :x2="timelineWidth" y2="60" stroke="#c7b3be" stroke-width="9" opacity="0.15"/>
                    <!-- 主时间轴线 -->
                    <line x1="0" y1="60" :x2="timelineWidth" y2="60" stroke="url(#lineGradient)" stroke-width="7" filter="url(#lineShadow)"/>
                    <!-- 高光线 -->
                    <line x1="0" y1="57" :x2="timelineWidth" y2="57" stroke="rgba(255,255,255,0.6)" stroke-width="2" opacity="0.8"/>
                    
                    <!-- 刻度 -->
                    <g v-for="tick in ticks" :key="tick.date">
                        <!-- 普通刻度线 -->
                        <line 
                            v-if="!tick.isTimeJump"
                            :x1="tick.x" 
                            :y1="tick.isEvent ? 45 : 50" 
                            :x2="tick.x" 
                            :y2="tick.isEvent ? 75 : 70" 
                            :stroke="tick.isEvent ? '#c7b3be' : '#e2d5d5'" 
                            :stroke-width="tick.isEvent ? 3 : 2"
                        />
                        <!-- 文字标签 -->
                        <text 
                            :x="tick.x" 
                            :y="tick.isEvent ? 95 : (tick.isTimeJump ? 100 : 90)" 
                            text-anchor="middle" 
                            :font-size="tick.isEvent ? 12 : (tick.isTimeJump ? 11 : 10)"
                            :fill="tick.isEvent ? '#666' : (tick.isTimeJump ? '#d4a5a5' : '#bbb')"
                            :font-weight="tick.isEvent ? '600' : (tick.isTimeJump ? '700' : '400')"
                            font-family="system-ui, -apple-system, sans-serif"
                        >
                            {{ tick.label }}
                        </text>
                    </g>
                </svg>

                <!-- 事件节点 -->
                <div 
                    v-for="(event, index) in filteredEvents" 
                    :key="index"
                    class="event-node"
                    :class="{ 
                        'above-line': getOriginalIndex(event) % 2 === 0, 
                        'below-line': getOriginalIndex(event) % 2 !== 0,
                        'has-image': event.image
                    }"
                    :style="{ left: getEventPosition(event.date) + 'px' }"
                >
                    <div class="event-dot"></div>
                    <div class="event-card" :class="{ 'blog-card': isBlogEvent(event) }">
                        <!-- Blog标记 -->
                        <div v-if="isBlogEvent(event)" class="blog-badge" :class="{ 'has-image-badge': event.image }">
                            <svg viewBox="0 0 24 24" width="16" height="16">
                                <path fill="currentColor" d="M19,2L14,6.5V17.5L19,13V2M6.5,5C4.55,5 2.45,5.4 1,6.5V21.16C1,21.41 1.25,21.66 1.5,21.66C1.6,21.66 1.65,21.59 1.75,21.59C3.1,20.94 5.05,20.5 6.5,20.5C8.45,20.5 10.55,20.9 12,22C13.35,21.15 15.8,20.5 17.5,20.5C19.15,20.5 20.85,20.81 22.25,21.56C22.35,21.61 22.4,21.59 22.5,21.59C22.75,21.59 23,21.34 23,21.09V6.5C22.4,6.05 21.75,5.75 21,5.5V19C19.9,18.65 18.7,18.5 17.5,18.5C15.8,18.5 13.35,19.15 12,20V6.5C10.55,5.4 8.45,5 6.5,5Z"/>
                            </svg>
                        </div>
                        <!-- 图片标记 -->
                        <div v-if="event.image" class="image-badge">
                            <svg viewBox="0 0 24 24" width="16" height="16">
                                <path fill="currentColor" d="M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z"/>
                            </svg>
                        </div>
                        <div class="card-header" :style="{ background: getTagGradient(event.tags) }">
                            <div class="event-date">
                                <svg viewBox="0 0 24 24" width="14" height="14">
                                    <path fill="currentColor" d="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3H18V1M17,12H12V17H17V12Z"/>
                                </svg>
                                {{ formatDate(event.date) }}
                            </div>
                        </div>
                        <!-- 普通事件内容 -->
                        <template v-if="!isBlogEvent(event)">
                            <h3 class="event-title">{{ event.title }}</h3>
                            <div class="event-subtitle">{{ event.subtitle }}</div>
                            <p class="event-content">{{ event.content }}</p>
                        </template>
                        <!-- Blog卡片摘要 -->
                        <template v-else>
                            <div class="blog-summary">{{ getBlogSummary(event) }}</div>
                        </template>
                        <div class="event-footer" :class="{ 'blog-footer': isBlogEvent(event) }">
                            <div v-if="showTags && event.tags && event.tags.length > 0" class="event-tags">
                                <span 
                                    v-for="tag in event.tags" 
                                    :key="tag" 
                                    class="tag"
                                    :style="{ 
                                        '--tag-color': getTagColor(tag, tagColors, isDarkMode),
                                        background: `linear-gradient(in oklch 135deg, ${getTagColor(tag, tagColors, isDarkMode)}95 0%, ${getTagColor(tag, tagColors, isDarkMode)}80 50%, ${getTagColor(tag, tagColors, isDarkMode)}90 100%)`
                                    }"
                                >{{ tag }}</span>
                            </div>
                            <div class="event-meta">
                                <span v-if="showLocation && event.location" class="meta-item">
                                    <svg viewBox="0 0 24 24" width="14" height="14">
                                        <path fill="currentColor" d="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z"/>
                                    </svg>
                                    {{ event.location }}
                                </span>
                                <span v-if="showNote && event.note" class="meta-item">
                                    <svg viewBox="0 0 24 24" width="14" height="14">
                                        <path fill="currentColor" d="M14,10H19.5L14,4.5V10M5,3H15L21,9V19A2,2 0 0,1 19,21H5C3.89,21 3,20.1 3,19V5C3,3.89 3.89,3 5,3M5,5V19H19V12H12V5H5Z"/>
                                    </svg>
                                    {{ event.note }}
                                </span>
                            </div>
                            <!-- Blog阅读全文按钮 -->
                            <button v-if="isBlogEvent(event)" class="read-more-btn" @click="openBlog(event)">
                                <svg viewBox="0 0 24 24" width="16" height="16">
                                    <path fill="currentColor" d="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z"/>
                                </svg>
                                阅读全文
                            </button>
                        </div>
                    </div>
                    
                    <!-- 图片预览（移到卡片外部） - 上方卡片图片在下，下方卡片图片在上 -->
                    <div v-if="event.image" class="image-preview" :class="{ 'preview-below': getOriginalIndex(event) % 2 === 0, 'preview-above': getOriginalIndex(event) % 2 !== 0 }">
                        <img :src="event.image" :alt="event.title" @error="handleImageError">
                    </div>
                </div>
            </div>
        </div>

        <!-- 缩略图滚动栏 (仅水平模式) -->
        <div class="minimap-scrollbar">
            <div class="minimap-track" ref="minimapTrack" @mousedown="clickMinimapTrack">
                <!-- 事件颜色带 -->
                <div 
                    v-for="event in filteredEvents" 
                    :key="event.date"
                    class="minimap-item"
                    :style="getMinimapItemStyle(event)"
                    @click="scrollToEvent(event)"
                    :title="event.title"
                ></div>
                <!-- 可拖动的视口窗口 -->
                <div 
                    class="minimap-viewport" 
                    :style="{
                        left: (minimap.scrollRatio * (100 - minimap.viewportWidth)) + '%',
                        width: minimap.viewportWidth + '%'
                    }"
                    @mousedown="startMinimapDrag"
                ></div>
            </div>
        </div>
        
        <!-- Blog模态弹窗 -->
        <div class="blog-modal" :class="{ active: currentBlog.visible }" @click.self="closeBlog">
            <div class="blog-modal-content">
                <div class="blog-modal-header" :style="{ background: currentBlog.event ? getTagGradient(currentBlog.event.tags) : 'linear-gradient(in oklch 135deg, var(--accent), var(--secondary))' }">
                    <div class="blog-modal-meta">
                        <div class="blog-modal-date">{{ currentBlog.event ? formatDate(currentBlog.event.date) : '' }}</div>
                        <div class="blog-modal-info">
                            <span v-if="currentBlog.event && currentBlog.event.location">
                                <svg viewBox="0 0 24 24" width="14" height="14" style="vertical-align: middle;">
                                    <path fill="currentColor" d="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z"/>
                                </svg>
                                {{ currentBlog.event.location }}
                            </span>
                            <span v-if="currentBlog.event && currentBlog.event.tags && currentBlog.event.tags.length > 0">
                                <svg viewBox="0 0 24 24" width="14" height="14" style="vertical-align: middle;">
                                    <path fill="currentColor" d="M5.5,7A1.5,1.5 0 0,1 4,5.5A1.5,1.5 0 0,1 5.5,4A1.5,1.5 0 0,1 7,5.5A1.5,1.5 0 0,1 5.5,7M21.41,11.58L12.41,2.58C12.05,2.22 11.55,2 11,2H4C2.89,2 2,2.89 2,4V11C2,11.55 2.22,12.05 2.59,12.41L11.58,21.41C11.95,21.77 12.45,22 13,22C13.55,22 14.05,21.77 14.41,21.41L21.41,14.41C21.77,14.05 22,13.55 22,13C22,12.44 21.77,11.94 21.41,11.58Z"/>
                                </svg>
                                {{ currentBlog.event.tags.join(', ') }}
                            </span>
                        </div>
                    </div>
                    <button class="blog-modal-close" @click="closeBlog">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor" d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
                        </svg>
                    </button>
                </div>
                <div class="blog-modal-body">
                    <div v-if="currentBlog.loading" style="text-align: center; padding: 40px;">
                        <p>加载中...</p>
                    </div>
                    <div v-else class="markdown-content" v-html="currentBlog.renderedContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>
